<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>map test</title>
</head>
<link rel="stylesheet" href="CesiumUnminified/Widgets/widgets.css">
<link rel="stylesheet" href="style.css">

<body>
    <div class="topnav">
        Header
    </div>

    <div class="sidenav">
        <button type="button" onclick="toggle_visibility()">Data</button>
    </div>

    <div id="navtab" class="tab">
        <button class="tablinks" onclick="openTab(event, 'data')">Data</button>
        <button class="tablinks" onclick="openTab(event, 'blink')">Blink</button>
    </div>

    <div id="data" class="tabcontent">
        <ul id="list">
        </ul>
        <button onclick="previousPage()">Back</button>
        <button onclick="nextPage()">Next</button>
    </div>

    <div id="blink" class="tabcontent">
    </div>

    <div id="map"></div>

    <script src="mago3d/mago3d.js"></script>
    <script src="CesiumUnminified/Cesium.js"></script>
    <script>
        var geopolicy = {};
        geopolicy.basicGlobe = 'cesium';
        geopolicy.terrainType = 'cesium-ion-default';
        geopolicy.initCameraEnable = true;
        geopolicy.initLatitude = 35.139482;
        geopolicy.initLongitude = 128.917656;
        geopolicy.initAltitude = 500;
        geopolicy.initDuration = 0.5;

        var map = new Mago3D.Mago3d('map', geopolicy);

        var f4dController = map.getF4dController();

        var f4dGroup = {
            "metainfo": {
                "isPhysical": false
            },
            "dataGroupId": 1,
            "dataGroupKey": "guide",
            "dataGroupName": "가이드 데이터 그룹",
            "dataGroupPath": "guide",
            "datas": []
        };

        var elementObject = {
            "metainfo": {
                "isPhysical": true,
                "flipYTexCoords": true,
                "heightReference": "clampToGround",
                "isVisible": true
            },
            "dataId": 1,
            "dataGroupId": 1,
            "dataKey": 'default',
            "dataName": 'default',
            "mappingType": "boundingboxcenter",
            "longitude": 128.917656,
            "latitude": 35.139482,
            "height": 14.177629,
            "heading": 0.000000,
            "pitch": 0.000000,
            "roll": 0.000000
        };

        function loadJSON(callback, pathToJson) {
            var xobj = new XMLHttpRequest();
            xobj.overrideMimeType("application/json");
            xobj.open('GET', pathToJson, true);
            xobj.onreadystatechange = function() {
                if (xobj.readyState == 4 && xobj.status == "200") {
                    // Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
                    callback(xobj.responseText);
                }
            };
            xobj.send(null);
        }

        var path = 'f4d/guide/mergedLonsLats.json';
        var datalist = [];

        loadJSON(function(response) {
            // Parse JSON string into object
            var actual_JSON = JSON.parse(response);
            for (let i = 0; i < actual_JSON.length; i++) {
                let newElementObject = JSON.parse(JSON.stringify(elementObject));
                newElementObject.dataKey = actual_JSON[i].data_key;
                newElementObject.dataKey = actual_JSON[i].data_key;
                newElementObject.longitude = actual_JSON[i].longitude;
                newElementObject.latitude = actual_JSON[i].latitude;
                newElementObject.dataId += i;
                f4dGroup.datas.push(newElementObject);
                f4dController.addF4dGroup(f4dGroup);
                datalist.push(actual_JSON[i].data_key);
            }
            // Fill the data tab with data_key information
            var listdiv = document.getElementById('list');
            var sliceddata = datalist.slice(0, 10);
            for (let i = 0; i < sliceddata.length; i++) {
                const element = sliceddata[i];
                var entry = document.createElement('li');
                entry.appendChild(document.createTextNode(datalist.length - datalist.indexOf(element) + " " + element));
                listdiv.appendChild(entry);
            }
        }, path);

        function toggle_visibility() {
            var e = document.getElementById("navtab");
            if (e.style.display == 'block') {
                e.style.display = 'none';
                tablinks = document.getElementsByClassName("tablinks");
                for (i = 0; i < tablinks.length; i++) {
                    tablinks[i].className = tablinks[i].className.replace(" active", "");
                }
                tabcontent = document.getElementsByClassName("tabcontent");
                for (i = 0; i < tabcontent.length; i++) {
                    tabcontent[i].style.display = "none";
                }
            } else {
                e.style.display = 'block';
            }
        }

        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            // Get all elements with class="tabcontent" and hide them
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            // Get all elements with class="tablinks" and remove the class "active"
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            // Show the current tab, and add an "active" class to the button that opened the tab
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }


        var pageSize = 10;
        var pageNum = 1;

        function loadData() {
            var listdiv = document.getElementById('list');
            listdiv.innerHTML = "";
            var sliceddata = datalist.slice(pageNum * pageSize, (pageNum + 1) * pageSize);
            for (let i = 0; i < sliceddata.length; i++) {
                const element = sliceddata[i];
                var entry = document.createElement('li');
                entry.appendChild(document.createTextNode(datalist.length - datalist.indexOf(element) + " " + element));
                listdiv.appendChild(entry);
            }
        }

        function nextPage() {
            pageNum++;
            loadData();
        }

        function previousPage() {
            pageNum--;
            loadData();
        }
    </script>
</body>

</html>